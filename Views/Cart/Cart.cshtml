@model IEnumerable<P_CStore.Models.CartViewModel>

@{
    ViewData["Title"] = "My Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="message" style="display:none;" class="alert"></div>

<div class="container mt-5">
    <h2 class="mb-4 fw-bold text-center">🛒 My Shopping Cart</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-info text-center">
            Your cart is empty. Add products to get started!
        </div>
    }
    else
    {
        <div class="row gy-4 justify-content-center">
            @foreach (var item in Model)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0 text-center">
                        @if (item.Picture != null && item.Picture.Length > 0)
                        {
                            var base64Image = Convert.ToBase64String(item.Picture);
                            var imageSrc = $"data:image/png;base64,{base64Image}";
                            <a href="@Url.Action("ProductView", "Home", new { idProduct = item.IdProduct })">
                                <img src="@imageSrc" class="card-img-top mx-auto" style="height: 250px; object-fit: contain; max-width: 100%;" />
                            </a>
                        }
                        else
                        {
                            <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                                <span class="text-muted">No Image</span>
                            </div>
                        }

                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">@item.Title</h5>

                            <p class="card-text text-success mb-2">
                                Price: <strong>@item.Price.ToString("C")</strong>
                            </p>

                            <div class="mb-3">
                                <label for="quantity-@item.IdProduct" class="form-label small">Quantity</label>
                                <input type="number" class="form-control quantity mx-auto" id="quantity-@item.IdProduct" name="Quantity" value="@item.Quantity" min="1" data-price="@item.Price" data-idproduct="@item.IdProduct" style="max-width: 100px;" />
                            </div>

                            <div class="d-flex justify-content-center align-items-center mt-auto gap-3 flex-column">
                                <span class="subtotal fw-bold text-primary">Subtotal: @item.Price * @item.Quantity</span>

                                <a asp-action="DeleteProductFromCart" asp-route-idProduct="@item.IdProduct" class="btn btn-outline-danger btn-sm w-50 mx-auto">
                                    🗑 Remove
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="text-center mt-5">
            <button class="btn btn-lg btn-success px-5 shadow" id="btnBuy">
                ✅ Proceed to Checkout
            </button>
        </div>
    }
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/cart.css" />
}

@section Scripts {
    <script src="~/js/cart.js"></script>
}
